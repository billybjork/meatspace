<main id="review" phx-hook="ReviewHotkeys">
  <!-- Empty-queue -------------------------------------------------------- -->
  <%= if @page_state == :empty do %>
    <section class="stack-center gap-4">
      <h2>All clips reviewed!</h2>
      <p class="muted">Check back later for more.</p>

      <nav role="group" aria-label="Review actions" class="actions">
        <button
          type="button"
          phx-click="undo"
          class="btn-ghost"
          disabled={@history == []}
          aria-label="Undo last action"
          title={if @history == [], do: "Nothing to undo", else: "Undo last action"}>
          â¬…ï¸
        </button>
      </nav>
    </section>

  <!-- Reviewing ---------------------------------------------------------- -->
  <% else %>
    <%= if @future != [] do %>
      <link rel="preload" as="image" href={@future |> List.first() |> sprite_url()} />
    <% end %>

    <article class="stack-center gap-4">
      <.sprite_player clip={@current} />

      <nav role="group" aria-label="Review actions" class="actions">
        <button
          phx-click="undo"
          class="btn-ghost"
          disabled={@history == []}
          aria-label="Undo"
          title={if @history == [], do: "Nothing to undo", else: "Undo last action"}>
          â¬…ï¸
        </button>

        <button id="btn-approve" class="btn approve" phx-click="select" phx-value-action="approve">
          âœ… Approve
        </button>
        <button id="btn-skip" class="btn skip" phx-click="select" phx-value-action="skip">
          â¡ï¸ Skip
        </button>
        <button id="btn-archive" class="btn archive" phx-click="select" phx-value-action="archive">
          ğŸ—‘ï¸ Archive
        </button>
        <button id="btn-merge" class="btn merge" phx-click="select" phx-value-action="merge"
                disabled={@history == []}
                title={if @history == [], do: "No previous clip to merge with", else: "Merge with previous clip"}>
          ğŸ”— Merge
        </button>
        <button id="btn-group" class="btn group" phx-click="select" phx-value-action="group"
                disabled={@history == []}
                title={if @history == [], do: "No previous clip to group with", else: "Group with previous clip"}>
          ğŸ–‡ï¸ Group
        </button>

        <button id={"split-#{@current.id}"} class="btn split" data-clip-id={@current.id}>
          âœ‚ï¸ Split
        </button>
      </nav>

      <p :if={msg = @flash["info"]}
         class={["flash", "flash--#{@flash_action}"]}
         aria-live="polite">
        <%= msg %>
      </p>
    </article>
  <% end %>
</main>